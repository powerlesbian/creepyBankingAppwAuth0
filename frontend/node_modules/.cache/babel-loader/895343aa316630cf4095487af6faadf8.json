{"ast":null,"code":"import _regeneratorRuntime from\"/Users/daddysgirl/Desktop/creepyBankingAppwAuth0/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/Users/daddysgirl/Desktop/creepyBankingAppwAuth0/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/Users/daddysgirl/Desktop/creepyBankingAppwAuth0/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/daddysgirl/Desktop/creepyBankingAppwAuth0/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from\"react\";import{Button,Alert}from\"reactstrap\";import Highlight from\"../components/Highlight\";import{useAuth0,withAuthenticationRequired}from\"@auth0/auth0-react\";import{getConfig}from\"../config\";import Loading from\"../components/Loading\";export var ExternalApiComponent=function ExternalApiComponent(){var _getConfig=getConfig(),_getConfig$apiOrigin=_getConfig.apiOrigin,apiOrigin=_getConfig$apiOrigin===void 0?\"http://localhost:3001\":_getConfig$apiOrigin,audience=_getConfig.audience;var _useState=useState({showResult:false,apiMessage:\"\",error:null}),_useState2=_slicedToArray(_useState,2),state=_useState2[0],setState=_useState2[1];var _useAuth=useAuth0(),getAccessTokenSilently=_useAuth.getAccessTokenSilently,loginWithPopup=_useAuth.loginWithPopup,getAccessTokenWithPopup=_useAuth.getAccessTokenWithPopup;var handleConsent=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return getAccessTokenWithPopup();case 3:setState(_objectSpread(_objectSpread({},state),{},{error:null}));_context.next=9;break;case 6:_context.prev=6;_context.t0=_context[\"catch\"](0);setState(_objectSpread(_objectSpread({},state),{},{error:_context.t0.error}));case 9:_context.next=11;return callApi();case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,6]]);}));return function handleConsent(){return _ref.apply(this,arguments);};}();var handleLoginAgain=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return loginWithPopup();case 3:setState(_objectSpread(_objectSpread({},state),{},{error:null}));_context2.next=9;break;case 6:_context2.prev=6;_context2.t0=_context2[\"catch\"](0);setState(_objectSpread(_objectSpread({},state),{},{error:_context2.t0.error}));case 9:_context2.next=11;return callApi();case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[0,6]]);}));return function handleLoginAgain(){return _ref2.apply(this,arguments);};}();var callApi=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var token,response,responseData;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return getAccessTokenSilently();case 3:token=_context3.sent;_context3.next=6;return fetch(\"\".concat(apiOrigin,\"/api/external\"),{headers:{Authorization:\"Bearer \".concat(token)}});case 6:response=_context3.sent;_context3.next=9;return response.json();case 9:responseData=_context3.sent;setState(_objectSpread(_objectSpread({},state),{},{showResult:true,apiMessage:responseData}));_context3.next=16;break;case 13:_context3.prev=13;_context3.t0=_context3[\"catch\"](0);setState(_objectSpread(_objectSpread({},state),{},{error:_context3.t0.error}));case 16:case\"end\":return _context3.stop();}}},_callee3,null,[[0,13]]);}));return function callApi(){return _ref3.apply(this,arguments);};}();var handle=function handle(e,fn){e.preventDefault();fn();};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"mb-5\"},state.error===\"consent_required\"&&/*#__PURE__*/React.createElement(Alert,{color:\"warning\"},\"You need to\",\" \",/*#__PURE__*/React.createElement(\"a\",{href:\"#/\",class:\"alert-link\",onClick:function onClick(e){return handle(e,handleConsent);}},\"consent to get access to users api\")),state.error===\"login_required\"&&/*#__PURE__*/React.createElement(Alert,{color:\"warning\"},\"You need to\",\" \",/*#__PURE__*/React.createElement(\"a\",{href:\"#/\",class:\"alert-link\",onClick:function onClick(e){return handle(e,handleLoginAgain);}},\"log in again\")),/*#__PURE__*/React.createElement(\"h1\",null,\"External API\"),/*#__PURE__*/React.createElement(\"p\",{className:\"lead\"},\"Ping an external API by clicking the button below.\"),/*#__PURE__*/React.createElement(\"p\",null,\"This will call a local API on port 3001 that would have been started if you run \",/*#__PURE__*/React.createElement(\"code\",null,\"npm run dev\"),\". An access token is sent as part of the request's `Authorization` header and the API will validate it using the API's audience value.\"),!audience&&/*#__PURE__*/React.createElement(Alert,{color:\"warning\"},/*#__PURE__*/React.createElement(\"p\",null,\"You can't call the API at the moment because your application does not have any configuration for \",/*#__PURE__*/React.createElement(\"code\",null,\"audience\"),\", or it is using the default value of \",/*#__PURE__*/React.createElement(\"code\",null,\"YOUR_API_IDENTIFIER\"),\". You might get this default value if you used the \\\"Download Sample\\\" feature of\",\" \",/*#__PURE__*/React.createElement(\"a\",{href:\"https://auth0.com/docs/quickstart/spa/react\"},\"the quickstart guide\"),\", but have not set an API up in your Auth0 Tenant. You can find out more information on\",\" \",/*#__PURE__*/React.createElement(\"a\",{href:\"https://auth0.com/docs/api\"},\"setting up APIs\"),\" in the Auth0 Docs.\"),/*#__PURE__*/React.createElement(\"p\",null,\"The audience is the identifier of the API that you want to call (see\",\" \",/*#__PURE__*/React.createElement(\"a\",{href:\"https://auth0.com/docs/get-started/dashboard/tenant-settings#api-authorization-settings\"},\"API Authorization Settings\"),\" \",\"for more info).\"),/*#__PURE__*/React.createElement(\"p\",null,\"In this sample, you can configure the audience in a couple of ways:\"),/*#__PURE__*/React.createElement(\"ul\",null,/*#__PURE__*/React.createElement(\"li\",null,\"in the \",/*#__PURE__*/React.createElement(\"code\",null,\"src/index.js\"),\" file\"),/*#__PURE__*/React.createElement(\"li\",null,\"by specifying it in the \",/*#__PURE__*/React.createElement(\"code\",null,\"auth_config.json\"),\" file (see the \",/*#__PURE__*/React.createElement(\"code\",null,\"auth_config.json.example\"),\" file for an example of where it should go)\")),/*#__PURE__*/React.createElement(\"p\",null,\"Once you have configured the value for \",/*#__PURE__*/React.createElement(\"code\",null,\"audience\"),\", please restart the app and try to use the \\\"Ping API\\\" button below.\")),/*#__PURE__*/React.createElement(Button,{color:\"primary\",className:\"mt-5\",onClick:callApi,disabled:!audience},\"Ping API\")),/*#__PURE__*/React.createElement(\"div\",{className:\"result-block-container\"},state.showResult&&/*#__PURE__*/React.createElement(\"div\",{className:\"result-block\",\"data-testid\":\"api-result\"},/*#__PURE__*/React.createElement(\"h6\",{className:\"muted\"},\"Result\"),/*#__PURE__*/React.createElement(Highlight,null,/*#__PURE__*/React.createElement(\"span\",null,JSON.stringify(state.apiMessage,null,2))))));};export default withAuthenticationRequired(ExternalApiComponent,{onRedirecting:function onRedirecting(){return/*#__PURE__*/React.createElement(Loading,null);}});","map":{"version":3,"sources":["/Users/daddysgirl/Desktop/creepyBankingAppwAuth0/src/views/ExternalApi.js"],"names":["React","useState","Button","Alert","Highlight","useAuth0","withAuthenticationRequired","getConfig","Loading","ExternalApiComponent","apiOrigin","audience","showResult","apiMessage","error","state","setState","getAccessTokenSilently","loginWithPopup","getAccessTokenWithPopup","handleConsent","callApi","handleLoginAgain","token","fetch","headers","Authorization","response","json","responseData","handle","e","fn","preventDefault","JSON","stringify","onRedirecting"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport { Button, Alert } from \"reactstrap\";\nimport Highlight from \"../components/Highlight\";\nimport { useAuth0, withAuthenticationRequired } from \"@auth0/auth0-react\";\nimport { getConfig } from \"../config\";\nimport Loading from \"../components/Loading\";\n\nexport const ExternalApiComponent = () => {\n  const { apiOrigin = \"http://localhost:3001\", audience } = getConfig();\n\n  const [state, setState] = useState({\n    showResult: false,\n    apiMessage: \"\",\n    error: null,\n  });\n\n  const {\n    getAccessTokenSilently,\n    loginWithPopup,\n    getAccessTokenWithPopup,\n  } = useAuth0();\n\n  const handleConsent = async () => {\n    try {\n      await getAccessTokenWithPopup();\n      setState({\n        ...state,\n        error: null,\n      });\n    } catch (error) {\n      setState({\n        ...state,\n        error: error.error,\n      });\n    }\n\n    await callApi();\n  };\n\n  const handleLoginAgain = async () => {\n    try {\n      await loginWithPopup();\n      setState({\n        ...state,\n        error: null,\n      });\n    } catch (error) {\n      setState({\n        ...state,\n        error: error.error,\n      });\n    }\n\n    await callApi();\n  };\n\n  const callApi = async () => {\n    try {\n      const token = await getAccessTokenSilently();\n\n      const response = await fetch(`${apiOrigin}/api/external`, {\n        headers: {\n          Authorization: `Bearer ${token}`,\n        },\n      });\n\n      const responseData = await response.json();\n\n      setState({\n        ...state,\n        showResult: true,\n        apiMessage: responseData,\n      });\n    } catch (error) {\n      setState({\n        ...state,\n        error: error.error,\n      });\n    }\n  };\n\n  const handle = (e, fn) => {\n    e.preventDefault();\n    fn();\n  };\n\n  return (\n    <>\n      <div className=\"mb-5\">\n        {state.error === \"consent_required\" && (\n          <Alert color=\"warning\">\n            You need to{\" \"}\n            <a\n              href=\"#/\"\n              class=\"alert-link\"\n              onClick={(e) => handle(e, handleConsent)}\n            >\n              consent to get access to users api\n            </a>\n          </Alert>\n        )}\n\n        {state.error === \"login_required\" && (\n          <Alert color=\"warning\">\n            You need to{\" \"}\n            <a\n              href=\"#/\"\n              class=\"alert-link\"\n              onClick={(e) => handle(e, handleLoginAgain)}\n            >\n              log in again\n            </a>\n          </Alert>\n        )}\n\n        <h1>External API</h1>\n        <p className=\"lead\">\n          Ping an external API by clicking the button below.\n        </p>\n\n        <p>\n          This will call a local API on port 3001 that would have been started\n          if you run <code>npm run dev</code>. An access token is sent as part\n          of the request's `Authorization` header and the API will validate it\n          using the API's audience value.\n        </p>\n\n        {!audience && (\n          <Alert color=\"warning\">\n            <p>\n              You can't call the API at the moment because your application does\n              not have any configuration for <code>audience</code>, or it is\n              using the default value of <code>YOUR_API_IDENTIFIER</code>. You\n              might get this default value if you used the \"Download Sample\"\n              feature of{\" \"}\n              <a href=\"https://auth0.com/docs/quickstart/spa/react\">\n                the quickstart guide\n              </a>\n              , but have not set an API up in your Auth0 Tenant. You can find\n              out more information on{\" \"}\n              <a href=\"https://auth0.com/docs/api\">setting up APIs</a> in the\n              Auth0 Docs.\n            </p>\n            <p>\n              The audience is the identifier of the API that you want to call\n              (see{\" \"}\n              <a href=\"https://auth0.com/docs/get-started/dashboard/tenant-settings#api-authorization-settings\">\n                API Authorization Settings\n              </a>{\" \"}\n              for more info).\n            </p>\n\n            <p>\n              In this sample, you can configure the audience in a couple of\n              ways:\n            </p>\n            <ul>\n              <li>\n                in the <code>src/index.js</code> file\n              </li>\n              <li>\n                by specifying it in the <code>auth_config.json</code> file (see\n                the <code>auth_config.json.example</code> file for an example of\n                where it should go)\n              </li>\n            </ul>\n            <p>\n              Once you have configured the value for <code>audience</code>,\n              please restart the app and try to use the \"Ping API\" button below.\n            </p>\n          </Alert>\n        )}\n\n        <Button\n          color=\"primary\"\n          className=\"mt-5\"\n          onClick={callApi}\n          disabled={!audience}\n        >\n          Ping API\n        </Button>\n      </div>\n\n      <div className=\"result-block-container\">\n        {state.showResult && (\n          <div className=\"result-block\" data-testid=\"api-result\">\n            <h6 className=\"muted\">Result</h6>\n            <Highlight>\n              <span>{JSON.stringify(state.apiMessage, null, 2)}</span>\n            </Highlight>\n          </div>\n        )}\n      </div>\n    </>\n  );\n};\n\nexport default withAuthenticationRequired(ExternalApiComponent, {\n  onRedirecting: () => <Loading />,\n});\n"]},"metadata":{},"sourceType":"module"}